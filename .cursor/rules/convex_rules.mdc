---
description: Convex development guidelines and best practices
globs: "convex/**/*"
alwaysApply: true
---
# Convex Rules

- Always use new function syntax for Convex functions.
- Always use strict argument and return validators.
- Register agent-facing mutations in convex/agentTools.ts (or agent directory).
- Never expose broad or unsafe mutations to agents.
- Document intent for all agent-facing mutations.
- Use file-based routing for organizing functions.
- Use internalQuery/internalMutation/internalAction for private functions.
- Use query/mutation/action for public functions.
- Always define schema in convex/schema.ts.
- Always include all index fields in the index name.
- Do NOT use filter in queries; use withIndex.
- Never use ctx.db in actions.
- Use ctx.runQuery, ctx.runMutation, ctx.runAction for function calls.
- Use v.null() for null return values.
- Be strict with types, especially for Ids.
- Never allow agent-facing mutations to use patch, replace, or delete on arbitrary tables.

